#!/usr/bin/env bash
# Configure HAProxy Load Balancer server

apt-get -y update
add-apt-repository -y ppa:vbernat/haproxy-2.7

apt-get -y install haproxy=2.7.\*

systemctl enable haproxy

cp /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.backup

echo "
frontend http
	bind *:80
	mode http
	default_backend web-backend
backend web-backend
	balance roundrobin
	server 161688-web-01 54.152.57.180:80 check
	server 161688-web-02 3.84.239.204:80 check
" >> /etc/haproxy/haproxy.cfg
systemctl restart haproxy
